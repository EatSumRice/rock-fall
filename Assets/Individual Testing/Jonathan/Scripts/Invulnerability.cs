using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;

public class Invulnerability : MonoBehaviour
{
    // Start is called before the first frame update
    public AttributesManager attributes;
    public GameObject shield;
    public Image shieldCooldown;
    public float coolDown = 3;
    public bool onCoolDown;
    public GameObject shootPoint;
    void Start()
    {
        shield.SetActive(false);
        shieldCooldown.fillAmount = 0;
        onCoolDown = false;
    }

    // Update is called once per frame
    void Update()
    {
        if (onCoolDown)
        {
            shieldCooldown.fillAmount -= 1 / coolDown * Time.deltaTime;
            if(shieldCooldown.fillAmount <= 0)
            {
                shieldCooldown.fillAmount = 0;
                onCoolDown = false;
            }
        }
    }

    private void OnCollisionEnter2D(Collision2D collision)
    {
        Debug.Log("potential damage collision?");
        // Debug.Log(collision);
        if (collision.gameObject.CompareTag("Enemy"))
            StartCoroutine("GetInvulnerable");
    }
    IEnumerator GetInvulnerable()
    {
        Physics2D.IgnoreLayerCollision(8, 11, true);
        shield.SetActive(true);
        Debug.Log("invulnerable :)");
        onCoolDown = true;
        shieldCooldown.fillAmount = 1;
        shootPoint.GetComponent<Shooting>().enabled = false;
        yield return new WaitForSeconds(3f);
        shootPoint.GetComponent<Shooting>().enabled = true;
        shield.SetActive(false);;
        Physics2D.IgnoreLayerCollision(8, 11, false);
    }
}
